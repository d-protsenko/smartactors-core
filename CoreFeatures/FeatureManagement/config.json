{
  "featureName":"info.smart_tools.smartactors:feature-management",
  "afterFeatures":["info.smart_tools.smartactors:iobject"],
  "objects":[
    {
      "name":"feature-manager",
      "dependency":"FeatureManager",
      "kind":"actor"
    },
    {
      "name":"download-feature-actor",
      "dependency":"DownloadFeatureActor",
      "kind":"stateless_actor"
    },
    {
      "name":"unzip-feature-actor",
      "dependency":"UnzipFeatureActor",
      "kind":"stateless_actor"
    },
    {
      "name":"load-feature-actor",
      "dependency":"LoadFeatureActor",
      "kind":"stateless_actor"
    },
    {
      "name":"all-in-directory-feature-tracker",
      "dependency":"AllInDirectoryFeatureTracker",
      "kind":"actor"
    },
    {
      "name":"constant_chain_call_receiver",
      "strategyDependency":"constant chain choice strategy",
      "dependency":"info.smart_tools.smartactors.message_processing.chain_call_receiver.ChainCallReceiver",
      "kind":"raw"
    },
    {
      "name":"directory-watcher",
      "dependency":"DirectoryWatcherActor",
      "kind":"actor"
    },
    {
      "name":"features-creator",
      "dependency":"FeatureCreatorActor",
      "kind":"stateless_actor"
    }
  ],
  "maps":[
    {
      "id":"loadFeatures",
      "steps":[
        {
          "handler":"addFeatures",
          "wrapper":{
            "in_getScatterChainName":"const/chainOfScatteredFeatures",
            "in_getMessageProcessor":"processor",
            "in_getFeatures":"message/features"
          },
          "target":"feature-manager"
        },
        {
          "handler":"getState",
          "wrapper":{
            "out_setFrozenRequests":"message/frozenFeatureRequests",
            "out_setLoadedFeatures":"message/loadedFeatures",
            "out_setFailedFeatures":"message/failedFeatures",
            "out_setProcessingFeatures":"message/processingFeatures",
            "out_setFrozenFeatureProcesses":"message/frozenFeatureProcesses"
          },
          "target":"feature-manager"
        }
      ],
      "exceptional":[
      ]
    },
    {
      "id":"chainOfScatteredFeatures",
      "steps":[
        {
          "handler":"download",
          "wrapper":{
            "in_getFeature":"message/feature"
          },
          "target":"download-feature-actor"
        },
        {
          "handler":"onFeatureStepCompleted",
          "wrapper":{
            "in_getFeature":"message/feature",
            "in_getMessageProcessor":"processor"
          },
          "target":"feature-manager"
        },
        {
          "handler":"unzip",
          "wrapper":{
            "in_getFeature":"message/feature"
          },
          "target":"unzip-feature-actor"
        },
        {
          "handler":"onFeatureStepCompleted",
          "wrapper":{
            "in_getFeature":"message/feature",
            "in_getMessageProcessor":"processor"
          },
          "target":"feature-manager"
        },
        {
          "handler":"load",
          "wrapper":{
            "in_getFeature":"message/feature",
            "in_getAfterFeaturesCallbackQueue": "message/afterFeaturesCallbackQueue"
          },
          "target":"load-feature-actor"
        },
        {
          "handler":"onFeatureLoaded",
          "wrapper":{
            "in_getFeature":"message/feature",
            "in_getAfterFeaturesCallbackQueue": "message/afterFeaturesCallbackQueue"
          },
          "target":"feature-manager"
        }
      ],
      "exceptional":[
      ]
    },
    {
      "id":"loadCoreFeaturesAndFeatures",
      "steps":[
        {
          "handler":"addFeatures",
          "wrapper":{
            "out_setFeatures":"message/features",
            "in_getPath":"const/corefeatures"
          },
          "target":"all-in-directory-feature-tracker"
        },
        {
          "chain":"loadFeatures",
          "target":"constant_chain_call_receiver"
        },
        {
          "handler":"addFeatures",
          "wrapper":{
            "out_setFeatures":"message/features",
            "in_getPath":"const/features"
          },
          "target":"all-in-directory-feature-tracker"
        },
        {
          "chain":"loadFeatures",
          "target":"constant_chain_call_receiver"
        }
      ],
      "exceptional":[
      ]
    },
    {
      "id":"createFeatures",
      "steps":[
        {
          "handler":"createFeaturesByMessage",
          "wrapper":{
            "in_getFeaturesDescription":"message/featuresDescription",
            "out_setFeatures":"message/features",
            "in_getRepositoriesDescription":"message/repositoriesDescription",
            "in_getFeatureDirectory":"const/features"
          },
          "target":"features-creator"
        },
        {
          "chain":"loadFeatures",
          "target":"constant_chain_call_receiver"
        }
      ],
      "exceptional":[
      ]
    },
    {
      "id":"onNewFile",
      "steps":[
        {
          "handler":"createMessageByFile",
          "wrapper":{
            "in_getFileName":"message/fileName",
            "in_getObservedDirectory":"message/observedDirectory",
            "out_setJsonRepositoriesDescription":"message/repositoriesDescription",
            "out_setJsonFeaturesDescription":"message/featuresDescription"
          },
          "target":"features-creator"
        },
        {
          "chain":"createFeatures",
          "target":"constant_chain_call_receiver"
        }
      ],
      "exceptional":[
      ]
    },
    {
      "id":"runDirectoryWatcher",
      "steps":[
        {
          "handler":"startService",
          "wrapper":{
            "in_getExecutionChain":"message/executionChain",
            "in_getObservedDirectory":"message/observedDirectory",
            "in_getObservedDirectoryFieldName":"message/observedDirectoryFieldName",
            "in_getFileNameFieldName":"message/fileNameFieldName"
          },
          "target":"directory-watcher"
        }
      ],
      "exceptional":[]
    }
  ],
  "onFeatureLoading":[
    {
      "messages":[
        {
        }
      ],
      "chain":"loadCoreFeaturesAndFeatures"
    },
    {
      "chain": "runDirectoryWatcher",
      "revert": false,
      "messages": [
        {
          "observedDirectory": "features",
          "executionChain": "onNewFile",
          "fileNameFieldName": "fileName",
          "observedDirectoryFieldName": "observedDirectory"
        }
      ]
    },
    {
      "chain": "stopDirectoryWatcher",
      "revert": true,
      "messages": [
        {
        }
      ]
    }
  ]
}
